@using BlazorBindings.Brutalist.Phosphor
@using MaterialColorUtilities.Schemes

<YogaClickableView Direction="Yoga.YGFlexDirection.YGFlexDirectionRow" AlignItems="center" Gap="8" OnClick="HandleClick"
                   Disabled="@Disabled" Cursor="@(Disabled ? "default" : null)">
    <YogaView Width="@ResolvedSize" Height="@ResolvedSize" Background="@ResolvedBoxBackground"
              BorderColor="@ResolvedBorderColor" BorderWidth="2" BorderRadius="@ResolvedRadius" JustifyContent="center"
              AlignItems="center" Cursor="@(Disabled ? "default" : null)">
        @if (Checked)
        {
            <PhosphorIcon Icon="PhosphorIcons.Check" Size="@ResolvedIconSize" Color="@ResolvedCheckColor" />
        }
    </YogaView>

    @if (!string.IsNullOrWhiteSpace(Label))
    {
        <YogaText Color="@ResolvedTextColor" FontSize="@ResolvedFontSize" Cursor="@(Disabled ? "default" : null)">
            @Label
        </YogaText>
    }
</YogaClickableView>

@code
{
    [CascadingParameter]
    public Scheme<uint>? Theme { get; set; }

    [Parameter]
    public bool Checked { get; set; }

    [Parameter]
    public EventCallback<bool> CheckedChanged { get; set; }

    [Parameter]
    public EventCallback<bool> OnChange { get; set; }

    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public float? Size { get; set; }

    [Parameter]
    public float? FontSize { get; set; }

    [Parameter]
    public string Tone { get; set; } = "Primary";

    [Parameter]
    public string? Background { get; set; }

    [Parameter]
    public string? BorderColor { get; set; }

    [Parameter]
    public string? CheckColor { get; set; }

    [Parameter]
    public string? Color { get; set; }

    private float ResolvedSize => Size ?? 18;
    private float ResolvedIconSize => 12;
    private float ResolvedFontSize => FontSize ?? 16f;
    private string ResolvedRadius => "2";

    private string SchemeMainColor => Tone switch
    {
        "Secondary" => Theme?.Secondary.ToHexColor() ?? "#6750A4",
        "Tertiary" => Theme?.Tertiary.ToHexColor() ?? "#7D5260",
        _ => Theme?.Primary.ToHexColor() ?? "#6750A4"
    };

    private string ResolvedBorderColor => Disabled
        ? (Theme?.Outline.ToHexColor() ?? "#79747E")
        : (BorderColor ?? (Checked ? SchemeMainColor : (Theme?.Outline.ToHexColor() ?? "#79747E")));

    private string? ResolvedBoxBackground => Disabled
        ? (Theme?.Outline.ToHexColor() ?? "#DDDDDD")
        : (Checked ? (Background ?? SchemeMainColor) : null);

    private string ResolvedCheckColor => CheckColor ?? (Theme?.OnPrimary.ToHexColor() ?? "#FFFFFF");

    private string ResolvedTextColor => Disabled
        ? (Theme?.OnSurface.ToHexColor() ?? "#1C1B1F")
        : (Color ?? (Theme?.OnBackground.ToHexColor() ?? "#1C1B1F"));

    private async Task HandleClick()
    {
        if (Disabled)
        {
            return;
        }

        var next = !Checked;
        Checked = next;

        if (CheckedChanged.HasDelegate)
        {
            await CheckedChanged.InvokeAsync(next);
        }

        if (OnChange.HasDelegate)
        {
            await OnChange.InvokeAsync(next);
        }
    }
}