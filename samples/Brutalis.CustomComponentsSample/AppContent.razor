@using BlazorBindings.Brutalist.Phosphor
@using Brutalis.CustomComponentsSample.Side
@using MaterialColorUtilities.Schemes
@using MaterialColorUtilities.Palettes
@using Microsoft.AspNetCore.Components.Routing
@inject NavigationManager Navigation

<YogaWindow Direction="Yoga.YGFlexDirection.YGFlexDirectionRow" Background="@CurrentTheme.Background.ToHexColor()"
            AlignItems="stretch" Position="relative">
    <SideNav />
    <YogaScrollableView Padding="24" Grow="1" Gap="16">
        <YogaView Padding="8 12" Shrink="0">
            <YogaText FontSize="12" Color="@CurrentTheme.OnSurfaceVariant.ToHexColor()">URI: @Navigation.Uri</YogaText>
        </YogaView>
        <Router AppAssembly="@typeof(AppContent).Assembly" OnNavigateAsync="OnNavigateAsync">
            <Found Context="routeData">
                <RouteView RouteData="@routeData" />
            </Found>
            <NotFound>
                <YogaWindow Background="#ffffff" Padding="40" Direction="Yoga.YGFlexDirection.YGFlexDirectionColumn"
                            Gap="8">
                    <YogaText FontSize="28" Color="#111827" TextAlign="left">404</YogaText>
                    <YogaText FontSize="16" Color="#6b7280" TextAlign="left">Route not found.</YogaText>
                </YogaWindow>
            </NotFound>
        </Router>
    </YogaScrollableView>

    @* Modal *@
    @if (IsModalOpen)
    {
        <YogaView Position="absolute" Top="0" Left="0" Right="0" Bottom="0" Background="#000000aa" JustifyContent="center"
                  AlignItems="center">
            <YogaView Background="@CurrentTheme.Surface1.ToHexColor()" BorderRadius="28" Padding="24" Gap="16" Width="400"
                      MaxHeight="600">
                <YogaText FontSize="24" Color="@CurrentTheme.OnSurface.ToHexColor()">
                    Modal Dialog
                </YogaText>
                <YogaText FontSize="14" Color="@CurrentTheme.OnSurfaceVariant.ToHexColor()" TextAlign="left" WrapText>
                    This is a modal positioned absolutely at the bottom of the component.
                </YogaText>
                <YogaView Direction="Yoga.YGFlexDirection.YGFlexDirectionRow" Gap="8" JustifyContent="flex-end">
                    @* <Button Label="Cancel" OnClick="CloseModal" Variant="Text" />
                    <Button Label="Confirm" OnClick="CloseModal" /> *@
                </YogaView>
            </YogaView>
        </YogaView>
    }
    <YogaView Position="absolute" Bottom="16" Right="16">
        <Button
        HeadIcon="@(CurrentTheme.Background < CurrentTheme.OnBackground ? @PhosphorIcons.Sun : @PhosphorIcons.Moon)"
        OnClick="@(CurrentTheme.Background < CurrentTheme.OnBackground ? UseLightTheme : UseDarkTheme)" />
    </YogaView>
</YogaWindow>

@code
{
    [Parameter]
    public EventCallback UseDarkTheme { get; set; }

    [Parameter]
    public EventCallback UseLightTheme { get; set; }

    private int Count;
    private bool IsModalOpen = false;

    private bool LoaderAnimated = true;
    private float LoaderSpeed = 1.6f;
    private float LoaderAmplitude = 8f;
    private bool AcceptedTerms;
    private bool EnableAnalytics = true;
    private string? SelectedFramework = "Blazor";
    private static readonly string[] FrameworkOptions = ["Blazor", "MAUI", "Skia", "OpenTK", "Yoga"];




    [CascadingParameter]
    public Scheme<uint> CurrentTheme { get; set; }





    private void ToggleLoaderAnimation()
    {
        LoaderAnimated = !LoaderAnimated;
        StateHasChanged();
    }

    private void IncreaseLoaderSpeed()
    {
        LoaderSpeed = Math.Min(4f, LoaderSpeed + 0.2f);
        StateHasChanged();
    }

    private void DecreaseLoaderSpeed()
    {
        LoaderSpeed = Math.Max(0.2f, LoaderSpeed - 0.2f);
        StateHasChanged();
    }

    private void IncreaseLoaderAmplitude()
    {
        LoaderAmplitude = Math.Min(16f, LoaderAmplitude + 1f);
        StateHasChanged();
    }

    private void DecreaseLoaderAmplitude()
    {
        LoaderAmplitude = Math.Max(2f, LoaderAmplitude - 1f);
        StateHasChanged();
    }

    private Task OnFrameworkChanged(string? value)
    {
        SelectedFramework = value;
        return Task.CompletedTask;
    }

    private Task OnNavigateAsync(NavigationContext context)
    {
        // Close the modal on navigation
        IsModalOpen = false;
        StateHasChanged();
        return Task.CompletedTask;
    }
}